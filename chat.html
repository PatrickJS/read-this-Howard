<!doctype html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="https://www.firebase.com/css/example.css">
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.2/angular.min.js"></script>
    <script src="https://cdn.firebase.com/v0/firebase.js"></script>
    <script src="https://cdn.firebase.com/libs/angularfire/0.3.0/angularfire.min.js"></script>
    <script src="http://momentjs.com/downloads/moment.min.js"></script>
  </head>
  <body ng-app="chat" ng-controller="MyController">
    <div id="messagesDiv">
      <div ng-repeat="msg in messages">
        <div ng-if="!msg.useHacks">
          <em>{{ msg.from }}</em>: {{ msg.body }} <small>{{ msg.date }}</small>
        </div>
        <div ng-if="msg.useHacks">
          <em>{{ msg.from }}</em>:<span ng-bind-html="msg.body"></span> <small>{{ msg.date }}</small>
        </div>
      </div>
    </div>
    <input type="checkbox" ng-model="useHacks" ng-value="true"> Use Hacks {{ useHacks }}<br>
    <input type="text" ng-model="name" placeholder="Name">
    <input type="text" ng-model="msg" ng-keydown="addMessage($event)" placeholder="Message...">
    <script>
      angular.module("chat", [
        "firebase"
      ])
      .controller('MyController', function($scope, angularFire) {
        var ref = new Firebase("https://gdi2290.firebaseio-demo.com/");

        $scope.messages = [];
        $scope.useHacks = false;

        angularFire(ref, $scope, "messages");

        $scope.addMessage = function(e) {
          if (e.keyCode != 13) return;
          $scope.messages.push({
            useHacks: !!$scope.useHacks,
            from: $scope.name,
            body: $scope.msg,
            date: moment(new Date()).fromNow()
          });
          $scope.msg = "";
          $scope.msg = null;
        };
      });
    </script>
  </body>
</html>
